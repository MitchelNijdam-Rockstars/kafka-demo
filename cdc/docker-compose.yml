version: '3.7'
services:
  zookeeper:
    image: debezium/zookeeper:1.1
    container_name: zookeeper
    ports:
      - 2181:2181
      - 2888:2888
      - 3888:3888
  kafka:
    image: debezium/kafka:1.1
    container_name: kafka
    ports:
      - 9092:9092
    links:
      - zookeeper
    environment:
      - KAFKA_ADVERTISED_HOST_NAME=localhost
      - ZOOKEEPER_CONNECT=zookeeper:2181
  mysql:
    image: debezium/example-mysql:1.1
    container_name: mysql
    command: --default-authentication-plugin=mysql_native_password --init-file /data/application/init.sql
    volumes:
        - ./data/mysql/data/init.sql:/data/application/init.sql
        - ./data/mysql/data:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=debezium
      - MYSQL_USER=mysqluser
      - MYSQL_PASSWORD=mysqlpw
    ports:
      - 3306:3306
  postgres:
    image: debezium/postgres:latest
    container_name: postgres
    ports: 
      - "5432:5432"
    environment: 
      - POSTGRES_USER=postgresuser
      - POSTGRES_PASSWORD=postgrespw
      - POSTGRES_DB=inventory
  schema-registry:
    image: confluentinc/cp-schema-registry
    container_name: schema-registry
    ports:
      - 8181:8181
      - 8081:8081
    environment:
      - SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL=zookeeper:2181
      - SCHEMA_REGISTRY_HOST_NAME=schema-registry
      - SCHEMA_REGISTRY_LISTENERS=http://schema-registry:8081
      - SCHEMA_REGISTRY_ACCESS_CONTROL_ALLOW_METHODS=GET,POST,PUT,OPTIONS
      - SCHEMA_REGISTRY_ACCESS_CONTROL_ALLOW_ORIGIN=*
    links:
      - zookeeper
  schema-registry-ui:
    image: landoop/schema-registry-ui
    container_name: schema-registry-ui
    ports:
      - 8000:8000
    environment: 
      - SCHEMAREGISTRY_URL=http://schema-registry:8081
      - PROXY=true
    links:
      - schema-registry
  connect:
    image: debezium/connect:1.1
    container_name: kafka-connect
    ports:
      - 8083:8083
    links:
      - zookeeper
      - kafka
      - mysql
      - postgres
    environment: 
      - BOOTSTRAP_SERVERS=kafka:9092
      - GROUP_ID=1
      - CONFIG_STORAGE_TOPIC=my_connect_configs
      - OFFSET_STORAGE_TOPIC=my_connect_offsets
      - STATUS_STORAGE_TOPIC=my_connect_statuses
      - KEY_CONVERTER=io.confluent.connect.avro.AvroConverter
      - VALUE_CONVERTER=io.confluent.connect.avro.AvroConverter
      - INTERNAL_KEY_CONVERTER=org.apache.kafka.connect.json.JsonConverter


